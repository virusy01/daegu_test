<link rel="import" href="/bower_components/iron-form/iron-form.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/src/components/common/number-input.html">

<link rel="import" href="/src/components/behaviors/behavior-loader.html">

<dom-module id="page-employment">

        <template>
	<iron-ajax id="getEmployment" method="get" headers='{"X-Requested-With": "XMLHttpRequest"}'
			       url$="/api/corp/employee/[[_corpSeq]]"
			       on-request="_startLoader"
	  		       on-response="_stopLoader"
			       last-response="{{_data}}">
	</iron-ajax>
	<form id="employmentForm" is="iron-form" 
		content-type="application/json"
		method="post" 
		action="/api/corp/employee" 
  		on-iron-form-presubmit="_parseDataBeforeSubmit"
  		on-iron-form-response="_submitResponse"
		class="form-horizontal">

		<template is="dom-if" if="{{!adminMode}}">
			<div class="page-header">
				<h2>고용현황 <small>Employment Status</small></h2>
				<div class="title-buttons">
					<button type="button" on-tap="_submitForm" class="btn btn-sm btn-primary">수정</button>
				</div>
			</div>
		</template>

		<template is="dom-if" if="{{adminMode}}">
			<div class="row">
				<div class="col-xs-12">
					<div class="text-right">
						<button type="button" on-tap="_submitForm" class="btn btn-sm btn-primary">수정</button>
					</div>
				</div>
			</div>
			<div class="horizontal-margin-20"></div>
		</template>

		<div id="alert" class="alert alert-dismissible hide" role="alert"></div>

		 <div class="form-group sub-header">
			  <div class="col-xs-10 col-xs-offset-2">
		<h4>고용인원(명)</h4>
		<hr/>
			  </div>
		  </div>

		  <div class="form-group">
		    <label class="col-xs-2 control-label">총 고용인원</label>
		    <div class="col-xs-4">
			    <number-input name="EMP_NUM" value="{{_data.EMP_NUM}}" placeholder="센터명" required></number-input>
		    </div>
		    <label class="col-xs-2 control-label">취약계층 총인원</label>
		    <div class="col-xs-4">
			    <number-input name="WEAK_NUM" value="{{_data.WEAK_NUM}}" placeholder="센터명" required></number-input>
		    </div>
		  </div>

		  <div class="form-group sub-header">
			  <div class="col-xs-10 col-xs-offset-2">
		<h4>근로자 고용현황(명)</h4>
		<hr/>
			  </div>
		  </div>

		  <div class="row">
		  <div class="col-xs-10 col-xs-offset-2">
			  <h5>취약계층 고용현황</h5>
		  </div>
		  </div>

		  <div class="form-group">
		    <label class="col-xs-2 control-label">고령</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_SILVER_NUM" value="{{_data.WEAK_SILVER_NUM}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">장애</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_HANDICAP_NUM" value="{{_data.WEAK_HANDICAP_NUM}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">저소득</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_POOR_NUM" value="{{_data.WEAK_POOR_NUM}}" placeholder="센터명"></number-input>
		    </div>
		  </div>

		  <div class="form-group">
		    <label class="col-xs-2 control-label">다문화가정</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_MIXBLOOD_NUM" value="{{_data.WEAK_MIXBLOOD_NUM}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">북한이탈주민</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_NK_NUM" value="{{_data.WEAK_NK_NUM}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">청년</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_YOUNG_NUM" value="{{_data.WEAK_YOUNG_NUM}}" placeholder="센터명"></number-input>
		    </div>
		  </div>

		  <div class="form-group">
		    <label class="col-xs-2 control-label">경력단절</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_LOST_JOB_NUM" value="{{_data.WEAK_LOST_JOB_NUM}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">한부모</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_ONE_PARENT_NUM" value="{{_data.WEAK_ONE_PARENT_NUM}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">가정폭력피해</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_FAMILY_VIOLENCE_NUM" value="{{_data.WEAK_FAMILY_VIOLENCE_NUM}}" placeholder="센터명"></number-input>
		    </div>
		  </div>

		  <div class="form-group">
		    <label class="col-xs-2 control-label">갱생보호대상</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_EXCONVICT_NUM" value="{{_data.WEAK_EXCONVICT_NUM}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">범죄피해자</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_CRIMINAL_VICTIM_NUM" value="{{_data.WEAK_CRIMINAL_VICTIM_NUM}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">성매매피해</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_PROSTITUTION_VICTIM_NUM" value="{{_data.WEAK_PROSTITUTION_VICTIM_NUM}}" placeholder="센터명"></number-input>
		    </div>
		  </div>

		   <div class="form-group">
		    <label class="col-xs-2 control-label">기타</label>
		    <div class="col-xs-2">
			    <number-input name="WEAK_ETC_NUM" value="{{_data.WEAK_ETC_NUM}}" placeholder="센터명"></number-input>
		    </div>
		  </div>


		  <div class="row">
		  <div class="col-xs-10 col-xs-offset-2">
			  <h5>연령병 고용현황</h5>
		  </div>
		  </div>

		   <div class="form-group">
		    <label class="col-xs-2 control-label">39세이하</label>
		    <div class="col-xs-2">
			    <number-input name="AGE_LESS40" value="{{_data.AGE_LESS40}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">40~54세</label>
		    <div class="col-xs-2">
			    <number-input name="AGE_LESS55" value="{{_data.AGE_LESS55}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">55~65세</label>
		    <div class="col-xs-2">
			    <number-input name="AGE_LESS65" value="{{_data.AGE_LESS65}}" placeholder="센터명"></number-input>
		    </div>
		  </div>

		   <div class="form-group">
		    <label class="col-xs-2 control-label">65세초과</label>
		    <div class="col-xs-2">
			    <number-input name="AGE_MORE65" value="{{_data.AGE_MORE65}}" placeholder="센터명"></number-input>
		    </div>
		  </div>

			
		   <div class="row">
		  <div class="col-xs-10 col-xs-offset-2">
			  <h5>연령병 고용현황</h5>
		  </div>
		  </div>

	   	<div class="form-group">
		    <label class="col-xs-2 control-label">남성</label>
		    <div class="col-xs-4">
			    <number-input name="EMP_MALE_NUM" value="{{_data.EMP_MALE_NUM}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">여성</label>
		    <div class="col-xs-4">
			    <number-input name="EMP_FEMALE_NUM" value="{{_data.EMP_FEMALE_NUM}}" placeholder="센터명"></number-input>
		    </div>
		  </div>

		   <div class="form-group sub-header">
			  <div class="col-xs-10 col-xs-offset-2">
		<h4>고용 및 근로 현황(명)</h4>
		<hr/>
			  </div>
		  </div>

		  		   <div class="row">
		  <div class="col-xs-10 col-xs-offset-2">
			  <h5>고용형태</h5>
		  </div>
		  </div>

		  <div class="form-group">
		    <label class="col-xs-2 control-label">정규직</label>
		    <div class="col-xs-4">
			    <number-input name="PERM_EMP_NUM" value="{{_data.PERM_EMP_NUM}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">비정규직</label>
		    <div class="col-xs-4">
			    <number-input name="TEMP_EMP_NUM" value="{{_data.TEMP_EMP_NUM}}" placeholder="센터명"></number-input>
		    </div>
		  </div>

		  <div class="row">
		  <div class="col-xs-10 col-xs-offset-2">
			  <h5>근무현황</h5>
		  </div>
		  </div>

		  <div class="form-group">
		    <label class="col-xs-2 control-label">평균근무시간(시간/주)</label>
		    <div class="col-xs-4">
			    <number-input name="WEEK_LABOR_TIME" value="{{_data.WEEK_LABOR_TIME}}" placeholder="센터명"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">평균근속(년)</label>
		    <div class="col-xs-4">
			    <number-input name="LONG_WORK_YEAR" value="{{_data.LONG_WORK_YEAR}}" placeholder="센터명"></number-input>
		    </div>
		  </div>

		  <div class="form-group sub-header">
			  <div class="col-xs-10 col-xs-offset-2">
		<h4>급여수준(명)</h4>
		<hr/>
			  </div>
		  </div>

		  		   <div class="row">
		  <div class="col-xs-10 col-xs-offset-2">
			  <h5>월급여평균</h5>
		  </div>
		  </div>

		  		  <div class="form-group">
		    <label class="col-xs-2 control-label">임원</label>
		    <div class="col-xs-4">
			    <number-input name="OFFICER_SALARY" value="{{_data.OFFICER_SALARY}}"></number-input>
		    </div>
		    <label class="col-xs-2 control-label">임원 외</label>
		    <div class="col-xs-4">
			    <number-input name="NON_OFFICER_SALARY" value="{{_data.NON_OFFICER_SALARY}}"></number-input>
		    </div>
		  </div>

		  <input is="iron-input" name="CORP_SEQ" bind-value="[[_corpSeq]]" hidden></input>

	</form>
  </template>

        <script>
                Polymer({

                        is: 'page-employment',

			behaviors: [Lunch.LoaderBehavior],


			properties: {
				adminMode: {
					type: Boolean,
					value: false
				},
				readId: {
					type: Number,
					observer: '_callAPI'
				},
				_corpSeq: {
					type: Number,
					value: function() {
						return sessionStorage.corpSeq;
					},
					observer: '_getEmployment'
				},
			},

			_getEmployment: function(value) {
				this._corpSeq = value;
				this.$.getEmployment.generateRequest();
			},

			_callAPI: function(value) {
				if (value) {
					this.readId = value;
					this._corpSeq = value;
				}
			},

			_submitForm: function(e) {
				if (this.$.employmentForm.validate()) {
					this.$.employmentForm.submit();
				}
			},

			_submitResponse: function(e) {
				if (e.detail.response == 1) {
					this.$.alert.innerHTML = '수정되었습니다';
					this.$.alert.classList.remove('hide');	
					this.$.alert.classList.add('alert-success');
				}else {
					this.$.alert.innerHTML = '오류가 발생하였습니다';
					this.$.alert.classList.remove('hide');
					this.$.alert.classList.add('alert-danger');
				}

				this.async(function() {
					this.$.alert.classList.add('hide');
				}, 2000);
			},

			_parseDataBeforeSubmit: function(e) {
				var body = this.$.employmentForm.request.body;
				for (var key in body) {
					body[key] = accounting.unformat(body[key]);
				}
			},
                });
        </script>

</dom-module>
