<link rel="import" href="/bower_components/app-route/app-route.html">

<link rel="import" href="/src/components/common/normal-select.html">

<dom-module id="page-overall-status">
<template>
	<app-route route="{{route}}"
		   pattern="/app/overall-status/:tab"
		   data="{{routeData}}">
	</app-route>

	<div class="page-header">
		<h2>전체 현황조회 <small>Overall Status</small></h2>
	</div>

	<div class="row">
		<div class="col-xs-2">
			<normal-select id="year" value="{{_year}}" items="{{_yearList}}"></normal-select>
		</div>
		<div class="col-xs-2">
			<button on-tap="_getData" class="btn btn-sm btn-primary">재조회</button>
		</div>
	</div>

	<ul id="pageTab" class="nav nav-tabs">
		<li name="income"><a href="/app/overall-status/income">수입현황</a></li>
		<li name="expense"><a href="/app/overall-status/expense">비용현황</a></li>
		<li name="employment"><a href="/app/overall-status/employment">고용현황</a></li>
		<li name="contribution"><a href="/app/overall-status/contribution">사회적 공헌 활동 실적</a></li>
		<li name="monthly"><a href="/app/overall-status/monthly">월별 운영실적</a></li>
		<li name="summary"><a href="/app/overall-status/summary">요약</a></li>
	</ul>

	<iron-pages id="reportTabs" role="monthly-tab" selected="[[tab]]" attr-for-selected="name" fallback-selection="income" on-iron-select="_assignYear">
		<report-income name="income" year="[[_year]]" admin-mode="true" read-id="0"></report-income>
		<report-expense name="expense" year="[[_year]]" admin-mode="true" read-id="0"></report-expense>
		<report-employment name="employment" year="[[_year]]" admin-mode="true" read-id="0"></report-employment>
		<report-contribution name="contribution" year="[[_year]]" admin-mode="true" read-id="0"></report-contribution>
		<report-monthly name="monthly" year="[[_year]]" admin-mode="true" read-id="0"></report-monthly>
		<report-summary name="summary" year="[[_year]]" admin-mode="true" read-id="0"></report-summary>
	</iron-pages>
</template>
<script>
Polymer({
	is: 'page-overall-status',

	properties: {
		route: String,
		tab: {
			type: String,
			observer: "_selectTab"
		},
		_yearList: {
			type: Array,
			value: function() {
				var list = [];

				for (var i = 2013; i <= 2030; i++) {
					list.push({cdNm:i, cd:i});
				}

				return list;
			}
		},
		_year: {
			type: Number,
			value: function() {
				return moment().year();
			}
		},
	},
	
	observers: [
		'_determineTab(routeData.tab)'
	],

	_determineTab: function(value) {
		this.tab = value || "income";
	},

	_selectTab: function(newValue, oldValue) {
		var newTab = this.$.pageTab.querySelector("li[name='" + newValue + "']");
		var oldTab = this.$.pageTab.querySelector("li[name='" + oldValue +"']");

		if (oldTab) 
			oldTab.classList.remove('active');
		else
			this._deselectAllTabs();

		if (newTab)
			newTab.classList.add('active');

		this.importHref(
			this.resolveUrl('report/report-' + newValue + '.html'), null, null, true);
	},
	
	_deselectAllTabs: function() {
		var child;

		for (var key in Polymer.dom(this.$.pageTab).children) {
			child = Polymer.dom(this.$.pageTab).children[key];
			child.classList.remove('active');
		}
	},

	_getData: function(e) {
		this.$.reportTabs.selectedItem.requestData();
	},

	_assignYear: function(e) {
		var page = this.$.reportTabs.selectedItem;
		page.year = this._year;
		page.apiTrigger = !page.apiTrigger;
	},
});
</script>
</dom-module>
