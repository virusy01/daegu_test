<link rel="import" href="/bower_components/app-route/app-route.html">

<link rel="import" href="/src/components/common/normal-select.html">

<dom-module id="page-monthly-report">

<template>

<style>
	:host {
		display: block;
	}
</style>

<app-route route="{{route}}"
	   pattern="/app/monthly-report/:tab"
    data="{{routeData}}">
</app-route>

<div class="page-header">
	<h2>월간 운영실적 <small>Monthly Report</small></h2>
</div>

<div class="row">
	<div class="col-xs-2">
		<normal-select id="year" value="{{_year}}" items="{{_yearList}}"></normal-select>
	</div>
	<div class="col-xs-2">
		<button on-tap="_getData" class="btn btn-sm btn-primary">재조회</button>
	</div>
</div>

<ul id="pageTab" class="nav nav-tabs">
	<li name="income" role="presentation"><a href="/app/monthly-report/income">수입현황</a></li>
	<li name="expense" role="presentation"><a href="/app/monthly-report/expense">비용현황</a></li>
	<li name="employment" role="presentation"><a href="/app/monthly-report/employment">고용현황</a></li>
	<li name="contribution" role="presentation"><a href="/app/monthly-report/contribution">사회적 공헌 활동 실적</a></li>
	<li name="monthly" role="presentation"><a href="/app/monthly-report/monthly">월별 운영실적</a></li>
	<li name="summary" role="presentation"><a href="/app/monthly-report/summary">요약</a></li>
</ul>

<iron-pages id="reportTabs" role="monthly-tab" selected="[[tab]]" attr-for-selected="name" on-iron-select="_assignYear">
	<report-income name="income" year="[[_year]]"></report-income>
	<report-expense name="expense" year="[[_year]]"></report-expense>
	<report-employment name="employment" year="[[_year]]"></report-employment>
	<report-contribution name="contribution" year="[[_year]]"></report-contribution>
	<report-monthly name="monthly" year="[[_year]]"></report-monthly>
	<report-summary name="summary" year="[[_year]]"></report-summary>
</iron-pages>

</template>

<script>
	Polymer({

		is: 'page-monthly-report',

		properties: {
			route: String,
			tab: {
				type: String,
				observer: "_selectTab"
			},
			_yearList: {
				type: Array,
				value: function() {
					var list = [];

					for (var i = 2013; i <= 2030; i++) {
						list.push({cdNm:i, cd:i});
					}

					return list;
				}
			},
			_year: {
				type: Number,
				value: function() {
					return moment().year();
				}
			},
		},
		
		observers: [
			'_determineTab(routeData.tab)'
		],

		_determineTab: function(value) {
			this.tab = value || "income";
		},

		_selectTab: function(newValue, oldValue) {
			var newTab = this.$.pageTab.querySelector("li[name='" + newValue + "']");
		        var oldTab = this.$.pageTab.querySelector("li[name='" + oldValue +"']");

			newTab.classList.add('active');
			if (oldTab) 
				oldTab.classList.remove('active');

			this.importHref(
				this.resolveUrl('report/report-' + newValue + '.html'), null, null, true);
		},

		_getData: function(e) {
			if (confirm('재조회시 저장되지 않은 데이타는 날아갑니다. 계속하시겠습니까?'))
				this.$.reportTabs.selectedItem.requestData();
		},

		_assignYear: function(e) {
			var page = this.$.reportTabs.selectedItem;
			page.year = this._year;
			page.apiTrigger = !page.apiTrigger;
		},
	});
</script>

</dom-module>
