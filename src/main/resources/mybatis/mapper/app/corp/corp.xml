<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="snp.app.corp.CorpRepository">

	<!-- 협동조합 성과지표 조회 -->
	<select id="findSocialKpi" resultType="hashmap">
		SELECT
		L1.KPI_CD AS L1_KPI_CD
		, L1.KPI_NM AS L1_KPI_NM
		, L2.KPI_CD AS L2_KPI_CD
		, L2.KPI_NM AS L2_KPI_NM
		, L3.KPI_CD AS L3_KPI_CD
		, L3.KPI_NM AS L3_KPI_NM
		, L3.IS_GRADE AS IS_GRADE
		, null        AS STATUS
		FROM
		(
		SELECT * FROM SOCIAL_KPI WHERE LEVEL = 1
		) L1
		INNER JOIN
		(
		SELECT * FROM SOCIAL_KPI WHERE LEVEL = 2
		) L2 ON (L1.KPI_CD = L2.P_KPI_CD)
		INNER JOIN
		(
		SELECT * FROM SOCIAL_KPI WHERE LEVEL = 3
		) L3 ON (L2.KPI_CD = L3.P_KPI_CD)
		ORDER BY L3.LEVEL, L3.DISP_ORD

	</select>


	<select id="findKpi_detail" resultType="hashmap">
		<![CDATA[
		SELECT
		CORP_NM,
		IFNULL(RESULT, 0) AS RESULT
		FROM KPI_RESULT
		WHERE CORP_SEQ = #{p.CORP_SEQ}
		  AND YEAR = #{p.YEAR} AND KPI_CD = #{LEVEL3CODE}
		GROUP BY YEAR
		]]>
	</select>

	<!-- 협동조합 성과지표 조회 -->
	<select id="findCooperationKpi" resultType="hashmap">
		SELECT
		L1.KPI_CD AS L1_KPI_CD
		, L1.KPI_NM AS L1_KPI_NM
		, L2.KPI_CD AS L2_KPI_CD
		, L2.KPI_NM AS L2_KPI_NM
		, L3.KPI_CD AS L3_KPI_CD
		, L3.KPI_NM AS L3_KPI_NM
		, L3.IS_GRADE AS IS_GRADE
		, null        AS STATUS
		FROM
		(
		SELECT * FROM COOPERATION_KPI WHERE LEVEL = 1
		) L1
		INNER JOIN
		(
		SELECT * FROM COOPERATION_KPI WHERE LEVEL = 2
		) L2 ON (L1.KPI_CD = L2.P_KPI_CD)
		INNER JOIN
		(
		SELECT * FROM COOPERATION_KPI WHERE LEVEL = 3
		) L3 ON (L2.KPI_CD = L3.P_KPI_CD)
		ORDER BY L3.LEVEL, L3.DISP_ORD

	</select>


	<!-- 협동조합 성과지표 조회 -->
	<select id="findVillageKpi" resultType="hashmap">
		SELECT
		L1.KPI_CD AS L1_KPI_CD
		, L1.KPI_NM AS L1_KPI_NM
		, L2.KPI_CD AS L2_KPI_CD
		, L2.KPI_NM AS L2_KPI_NM
		, L3.KPI_CD AS L3_KPI_CD
		, L3.KPI_NM AS L3_KPI_NM
		, L3.IS_GRADE AS IS_GRADE
		, null        AS STATUS
		FROM
		(
		SELECT * FROM VILLAGE_KPI WHERE LEVEL = 1
		) L1
		INNER JOIN
		(
		SELECT * FROM VILLAGE_KPI WHERE LEVEL = 2
		) L2 ON (L1.KPI_CD = L2.P_KPI_CD)
		INNER JOIN
		(
		SELECT * FROM VILLAGE_KPI WHERE LEVEL = 3
		) L3 ON (L2.KPI_CD = L3.P_KPI_CD)
		ORDER BY L3.LEVEL, L3.DISP_ORD

	</select>










	<!-- 성과지표 등급별 분석 데모용-->
	<select id="chartDemo10" resultType="hashmap">
		SELECT COL2 as STATUS, COL3 as COUNT
		FROM DEMO_TBL
		WHERE SEQ = 1 and COL1= '0'
	</select>

	<!-- 성과지표 항목별 분석 데모용 -->
	<select id="chartDemo11" resultType="hashmap">
		SELECT COL2 as STATUS, COL3 as COUNT
		FROM DEMO_TBL
		WHERE SEQ = 1 and COL1= '1'
	</select>

	<!-- pie chart DEMO2 -->
	<select id="chartDemo12" resultType="hashmap">
		SELECT COL2 as STATUS, COL3 as COUNT
		FROM DEMO_TBL
		WHERE SEQ = 1 and COL1= '2'
	</select>

	<!-- pie chart DEMO3-->
	<select id="chartDemo13" resultType="hashmap">
		SELECT COL2 as STATUS, COL3 as COUNT
		FROM DEMO_TBL
		WHERE SEQ = 1 and COL1= '3'
	</select>

	<!-- 성과지표 항목별 분석 데모용-->
	<select id="chartDemo2" resultType="hashmap">
	SELECT a.*
	FROM (
		SELECT COL2 as RESULT
		FROM DEMO_TBL
		WHERE SEQ = 2 and COL1= #{p.CORP_KIND}
		ORDER BY COL3
	) a
	UNION	ALL
	SELECT b.*
	FROM (
	   SELECT avg(COL2) as RESULT
		FROM DEMO_TBL
		WHERE SEQ = 2 and COL1= #{p.CORP_KIND}
	  ) b
	</select>

	<!-- 성과지표 지역별 분석 데모용-->
	<select id="chartDemo3" resultType="hashmap">
		SELECT COL2 as RESULT
		FROM DEMO_TBL
		WHERE SEQ = 3 and COL1= #{p.CORP_KIND}
		ORDER BY COL3
	</select>

</mapper>
